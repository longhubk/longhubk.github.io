<!DOCTYPE html>
<html>
  <head>
    <title>VSB</title>
    <link rel="stylesheet" type="text/css" href="styles/main.css" />
    <link rel="shortcut icon" href="assets/vsb_icon_logo_4.png" />
    <script src="scripts/axios.js" type="text/javascript"></script>
    <script src="scripts/index.js" type="text/javascript"></script>
    <script src="scripts/search.js" type="text/javascript"></script>
  </head>

  <body>
    <div class="container">
      <ul id="nav">
        <li><a href="/">
          <!-- VSB -->
          <img src="assets/vsb_logo_2.svg" id="logo" alt="Logo SVG" />
        </a></li>
        <li><a href="/about.html">About</a></li>
        <li id="lg"></li>
        <li id="su"></li>
      </ul>
      <h2>Welcome to VSB (Very Simple Blog)</h2>
      <p>
        This is my blog page in github io platform. Read more about me...<a
          href="/about.html"
          >here</a
        >
      </p>
      <button onclick="randomNote()">Random</button>
      <div class="search-box" id="sb"></div>
      <ul id="list-note">
        Loading Post...
      </ul>
      <div id="pagination" class="fx wr">Loading Page...</div>
    </div>
    <footer></footer>
    <script type="text/javascript">
      const lg = document.getElementById("lg");
      const su = document.getElementById("su");
      const bs = document.getElementById("bs");
      const pg = document.getElementById("pagination");
      const ln = document.getElementById("list-note");
      const page = getQueryParam("page");
      const keyword = getQueryParam("keyword");

      (async () => {
        const isLogin = await checkIsLogin();
        console.log("res Is Login: ", isLogin);
        if (isLogin) {
          lg.innerHTML = `<a href='/note.manager.html'>${isLogin}</a>`;
          su.innerHTML = `<a href="#" onclick='return logout()'>Exit</a>`;
        } else {
          lg.innerHTML = `<a href="/login.html">Log In</a>`;
          su.innerHTML = `<a href="/signup.html">Sign Up</a>`;
        }
      })();

      const renderListNote = async (keyword = "") => {
        const countNote = (await getCountNote(keyword)).count;
        if (countNote) {
          const itemPage = await createPageItem(countNote, page);
          pg.innerHTML = itemPage;
        }
        const currentPage = page ? page : 1;
        const listNote = await getListNote(currentPage, keyword);
        let innerNote = getPageInfo(countNote, currentPage);
        for (const note of listNote) {
          innerNote += `<li class="note-item">
          <a class="note-tit" href='/note.view.html?noteId=${note._id}'>${
            note.title
          }</a>
          <p class="sub-txt">${new Date(note.created_at).toLocaleDateString()}</p>
          </li>`;
        }
        if (innerNote === "") {
          innerNote += NOT_FOUND;
        }
        ln.innerHTML = innerNote;
      };

      const randomNote = async () => {
        const randomNote = await getRandomNote();
        console.log({randomNote});
        redirect(`/note.view.html?noteId=${randomNote.id}`);
      }

      (async () => {
        await getServerUrl();
        await renderListNote(keyword);
        injectSearch(keyword);
        getFooter();
      })();
    </script>
  </body>
</html>
