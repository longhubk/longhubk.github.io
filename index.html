<!DOCTYPE html>
<html>

<head>
  <title>VSB</title>
  <link rel="stylesheet" type="text/css" href="main.css" />
  <link rel="shortcut icon" href="code.ico">
  <script src="axios.js" type="text/javascript"></script>
  <script src="index.js" type="text/javascript"></script>
</head>

<body>
  <div class="container">
    <ul id="nav">
      <li><a href="/">Home</a></li>
      <li><a href="/about.html">About</a></li>
      <li id="lg"><a href="/login.html">log in</a></li>
      <li id="su"><a href="/signup.html">sign up</a></li>
    </ul>
    <h2>Welcome to VSB - Very Simple Blog</h2>
    <p>
      This is my blog page in github io platform. <a href="/about.html">Read more about me...</a>
    </p>
    <p>New post here</p>
    <input id="is" type="text" value="" placeholder="type something" />
    <button id="bs" onclick="btnSearch()">search</button>
    <ul id="list-note"></ul>
    <div id="pagination"></div>
  </div>
  <!-- /.container -->
  <footer>
    <ul>
      <li><a href="mailto:longn7284@gmail.com">email</a></li>
      <li><a href="https://github.com/longhubk">longhubk</a></li>
    </ul>
  </footer>
  <script type="text/javascript">
    const lg = document.getElementById('lg');
    const su = document.getElementById('su');
    const bs = document.getElementById('bs');
    const is = document.getElementById('is');
    const pg = document.getElementById('pagination');
    const ln = document.getElementById('list-note');
    const page = getQueryParam('page');
    const keyword = getQueryParam('keyword');

    (async () => {
      const isLogin = await checkIsLogin();
      console.log('res Is Login: ', isLogin);
      if (isLogin) {
        lg.innerHTML = `<a href='/note.manager.html'>${isLogin}</a>`;
        su.innerHTML = `<a href="#" onclick='return logout()'>Log Out</a>`;
      }
    })();

    const btnSearch = () => {
      insertParam('keyword', is.value);
    }

    const renderListNote = async (keyword = '') => {
      const countNote = (await getCountNote(keyword)).count;
      console.log('countNote', countNote);
      if (countNote) {
        const itemPage = await createPageItem(countNote, page, '/index.html');
        console.log('itemPage 2', itemPage);
        pg.innerHTML = itemPage;
      }
      const currentPage = page ? page : 1;
      const listNote = await getListNote(currentPage, keyword);
      let innerNote = ''
      for (const note of listNote) {
       innerNote += `<li class="note-item">
          <a class="note-tit" href='/note.list.html?noteId=${note._id}'>${note.title}</a>
          <p>${new Date(note.created_at).toDateString()}</p>
          </li>`;
      }
      ln.innerHTML = innerNote;
    }
    
    (async () => {
      await renderListNote(keyword);
    })()
  </script>
</body>

</html>