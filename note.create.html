<!DOCTYPE html>
<html>

<head>
  <title>VSB</title>
  <link rel="stylesheet" type="text/css" href="styles/main.css" />
  <link rel="shortcut icon" href="code.ico">
  <script src="scripts/axios.js" type="text/javascript"></script>
  <script src="scripts/index.js" type="text/javascript"></script>
  <script src="scripts/auth.js" type="text/javascript"></script>
</head>

<body>
  <div class="container">
    <ul id="nav">
      <li><a href="/">Home</a></li>
      <li><a href="/note.manager.html">Manager</a></li>
    </ul>
    <div>
      <textarea id="txt-title" rows="2"></textarea><br /><br />
      <textarea id="txt-content" rows="20"></textarea><br /><br />
      <select id="note-state">
        <option value="0">Publish</option>
        <option value="1">Private</option>
        <option value="2">Hidden</option>
      </select>
      <select id="note-tag">
      </select>
      <button onclick="create()">create</button>
      <div style="width: 2rem"></div
    </div>
  </div>
  <footer>
  </footer>
  <script type="text/javascript">
    const txtField = document.getElementById('txt-content');
    const txtTitle = document.getElementById('txt-title');
    const noteState = document.getElementById('note-state');
    const noteTag = document.getElementById('note-tag');

    const create = async () => {
      const res = await createNote(txtTitle.value, txtField.value, noteState.value, noteTag.value);
      if (res.code === '00') {
        window.alert('create successfully');
        localStorage.removeItem("TAGS");
        window.location.href = `/note.list.html?noteId=${res.msg.noteId}&role=1`;
      } else {
        window.alert('create failed', res.msg);
      }
    }

    (async () => {
      await isLogin();
      const listTag = await getTag();
      let innerTag = ``;
      for(const tag of listTag) {
        innerTag += `<option value="${tag._id}">${tag.name}</option>`;
      }
      noteTag.innerHTML = innerTag;
      getFooter();
    })();

  </script>
</body>

</html>